{"version":3,"sources":["webpack:///./src/views/audioStream.vue?438c","webpack:///./src/views/audioStream.vue?1a05","webpack:///./src/views/audioStream.vue?7dbc","webpack:///./src/views/audioStream.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","staticStyle","attrs","_m","_v","staticRenderFns","components","AudioStreamComponent","component"],"mappings":"gHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,qCAAqCC,YAAY,CAAC,gBAAgB,UAAU,CAACH,EAAG,MAAM,CAACE,YAAY,eAAeE,MAAM,CAAC,OAAS,2JAA2J,CAACJ,EAAG,MAAM,CAACE,YAAY,UAAUC,YAAY,CAAC,OAAS,MAAM,CAACH,EAAG,MAAM,CAACE,YAAY,qDAAqDC,YAAY,CAAC,mBAAmB,YAAY,CAACH,EAAG,MAAM,CAACE,YAAY,yJAAyJ,CAACF,EAAG,MAAM,CAACE,YAAY,kBAAkBF,EAAG,MAAM,CAACE,YAAY,wBAAwB,CAACF,EAAG,MAAM,CAACE,YAAY,6DAA6DC,YAAY,CAAC,QAAU,UAAU,CAACH,EAAG,MAAM,CAACE,YAAY,kDAAkDC,YAAY,CAAC,QAAU,cAAc,CAACH,EAAG,MAAM,CAACE,YAAY,sEAAsEC,YAAY,CAAC,QAAU,IAAI,OAAS,IAAI,QAAU,eAAe,CAACH,EAAG,yBAAyB,GAAGA,EAAG,MAAM,CAACE,YAAY,4CAA4CC,YAAY,CAAC,QAAU,aAAa,iBAAiB,WAAW,CAACP,EAAIS,GAAG,GAAGL,EAAG,MAAM,CAACE,YAAY,kBAAkBF,EAAG,OAAO,CAACE,YAAY,2DAA2D,CAACN,EAAIU,GAAG,0QAA0QN,EAAG,KAAKA,EAAG,MAAM,CAACE,YAAY,kBAAkBF,EAAG,cAAc,CAACE,YAAY,YAAYE,MAAM,CAAC,GAAK,sBAAsB,CAACR,EAAIU,GAAG,oBAAoB,SAASN,EAAG,MAAM,CAACE,YAAY,6BAC57DK,EAAkB,CAAC,WAAa,IAAIX,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,IAAI,CAACA,EAAG,OAAO,CAACE,YAAY,qGAAqG,CAACN,EAAIU,GAAG,mEAAmEN,EAAG,U,oFCwEtS,EAArB,kJAAyC,QAApB,EAAW,gBAH/B,eAAU,CAACQ,WAAW,CACnBC,qBAAA,WAEiB,WCzEgX,I,YCOlYC,EAAY,eACd,EACAf,EACAY,GACA,EACA,KACA,KACA,MAIa,aAAAG,E","file":"js/radio.3d9511a7.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"columns is-multiline is-padding-10\",staticStyle:{\"margin-bottom\":\"-30px\"}},[_c('div',{staticClass:\"column is-12\",attrs:{\"classs\":\"column is-12-mobile is-10-tablet is-offset-1-tablet is-10-desktop is-offset-1-desktop is-10-widescreen is-offset-1-widescreen has-text-centered events\"}},[_c('div',{staticClass:\"columns\",staticStyle:{\"margin\":\"0\"}},[_c('div',{staticClass:\"column is-12 is-offset- has-text-left event-height\",staticStyle:{\"background-color\":\"#f4f9f9\"}},[_c('div',{staticClass:\"column is-12-mobile is-10-tablet is-offset-1-tablet is-10-desktop is-offset-1-desktop is-8-widescreen is-offset-2-widescreen has-text-centered events\"},[_c('div',{staticClass:\"is-padding-20\"}),_c('div',{staticClass:\"columns is-multiline\"},[_c('div',{staticClass:\"players column is-12 is-offset- has-text-left event-height\",staticStyle:{\"display\":\"table\"}},[_c('div',{staticClass:\"columns is-mobile is-multiline is-variable is-1\",staticStyle:{\"display\":\"table-row\"}},[_c('div',{staticClass:\"column is-12-mobile is-6-desktop is-offset- has-cursor fade-in pb-0\",staticStyle:{\"padding\":\"0\",\"margin\":\"0\",\"display\":\"table-cell\"}},[_c('AudioStreamComponent')],1),_c('div',{staticClass:\"column is-5-desktop pl-6 is-hidden-mobile\",staticStyle:{\"display\":\"table-cell\",\"vertical-align\":\"middle\"}},[_vm._m(0),_c('div',{staticClass:\"is-padding-10\"}),_c('span',{staticClass:\"has-text-grey-darker is-size-7-mobile is-size-7-desktop\"},[_vm._v(\"\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tLorem ipsum dolor sit amet, consectetur adipiscing elit. Ut et convallis dui. Praesent sagittis semper lorem, ut pulvinar libero euismod maximus. Vestibulum feugiat nibh vel rhoncus \\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tfaucibus\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\")]),_c('p'),_c('div',{staticClass:\"is-padding-10\"}),_c('router-link',{staticClass:\"btn black\",attrs:{\"to\":\"/media/livestream\"}},[_vm._v(\"watch us live\")])],1)])])]),_c('div',{staticClass:\"is-padding-20\"})])])])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('span',{staticClass:\"church-header has-weight-500 has-text-grey-darker is-size-5-desktop is-size-4-mobile is-uppercase\"},[_vm._v(\"\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tPREACH THE WORD\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\")]),_c('br')])}]\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\timport { Component, Vue, Watch, Prop } from \"vue-property-decorator\";\n\timport APPLICATION from \"@/webrtc/APPLICATION\";\n\timport AudioStreamComponent from '@/components/audioStream-janus.vue';\n\n\tdeclare global {\n\t\tinterface Window { videojs: any }\n\t}\n\n\t@Component({components:{\n    \tAudioStreamComponent\n\t}})\n\texport default class AudioStream extends Vue {\n\t\t/*static _socketServer = 'ws://' + process.env.VUE_APP_SERVER + ':' + process.env.VUE_APP_JANUS_PORT;\n\t\n\t\tstatic context  = new AudioContext();\n\t\tstatic analyser = AudioStream.context.createAnalyser();\n\t\tstatic frequency;\n\t\tstatic bufferLength;\n\t\tstatic source;\n\t\tstatic ctx;\n\t\tstatic WIDTH = 300; static HEIGHT = 100; static barWidth = 0;\n\t\tstatic canvas = null;\n\n\n\t\tplayer: HTMLMediaElement;\n\t\tprogressBar: HTMLElement;\n\t\tisMuted = false;\n\t\tisPlaying = false;\n\t\tcurrentTime = '';\n\t\tduration = '';\n\t\tshowTime = false;\n\t\tremainingTime = '0:00';\n\n\t\ttouchEvent = 'ontouchstart' in window ? 'touchstart' : 'click';\n        private servers:any = {\n            'iceServers': [{'urls': 'stun:stun.l.google.com:19302'}, \n            {'urls': 'turn:numb.viagenie.ca','credential': 'beaver','username': 'webrtc.websitebeaver@gmail.com'}]\n        };\n\n\t\tprivate paused:boolean = false;\n\t\tprivate streamEnd:boolean = false;\n\t\tprivate audioPlayer: any;\n\t\tprivate stream: MediaStream;\n\t\tis_player_active = false;\n\n\n\t\tsfuHandleA = null; janusA = null;\n\n\t\tpublic mounted() {\n\t\t\tthis.socketConnect();\n\n\t\t\twindow.addEventListener('playRadioEvent', () => {\n\t\t\t\tthis.isPlaying?\tthis.pause(): this.play();\n\t\t\t});\n\t\t\twindow.addEventListener('muteRadioEvent', () => {\n\t\t\t\tthis.isMuted?\tthis.unmute(): this.mute();\n\t\t\t});\n\n\t\t\tthis.player = document.getElementById('radioPlayer') as HTMLMediaElement;\n\t\t\tthis.player.onpause = () => this.isPlaying = false;\n\t\t\tthis.player.onplaying = () => this.isPlaying = true;\n\t\t}\n\n\n\t\tregisterAudioStream() {\n\t\t\tthis.janusA.attach({\n\t\t\t\tplugin: 'janus.plugin.videoroom',\n\t\t\t\tsuccess: (handle) =>{\n\t\t\t\t\tthis.sfuHandleA = handle;\n\t\t\t\t\tvar subscriber = { request: 'join', room: 2, ptype: 'subscriber', feed: 27053 };\n\t\t\t\t\tthis.sfuHandleA.send({message: subscriber});\n\t\t\t\t},\n\n\t\t\t\tonmessage: (message, desc) =>{\n\t\t\t\t\tif(desc) this.sfuHandleA.createAnswer({\n\t\t\t\t\t\tjsep: desc, media: {audioSend: false, video: false, data: false, audioRecv: true },\n\t\t\t\t\t\tsuccess: (jsep) => this.sfuHandleA.send({ message:{ request: 'start', room: 2}, jsep }),\n\t\t\t\t\t\terror: (error) => {}\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tonremotestream: (stream) => {\n\t\t\t\t\twindow.Janus.attachMediaStream(this.player, stream);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync _connectA(started) {\n\t\t\tif(started == 'yes') {\n\t\t\t\tthis.streamEnd = false;\n\t\t\t\twindow.Janus.init({\n\t\t\t\t\tdebug: false, dependencies: window.Janus.useDefaultDependencies(), callback: () => {\n\t\t\t\t\t\tthis.janusA = new window.Janus({\n\t\t\t\t\t\t\tserver:  AudioStream._socketServer,\n\t\t\t\t\t\t\ticeServers: this.servers.iceServers,\n\t\t\t\t\t\t\tsuccess: () => this.registerAudioStream(),\n\t\t\t\t\t\t\terror: (cause) => console.log('CAUSE cannt create JANU ' + cause)\n\t\t\t\t\t\t})\t\n\t\t\t\t\t}\n\t\t\t\t});\t\t\n\t\t\t}else{\n\t\t\t\tthis.streamEnd = true;\n\t\t\t}\n\t\t}\n\n\t\tasync _disconnectA() {\n\t\t\t// leave empty so radio can play in the background\n\t\t\tif(this.sfuHandleA != null)  this.sfuHandleA.send({message:{request: 'leave'}});\n\t\t}\n\n\t\ttogglePlay() {\n\t\t\tthis.isPlaying? this.pause(): this.play();\n\t\t}\n\n\t\tplay() {\n\t\t\tthis.player.play();\n\t\t}\n\n\t\tpause() {\n\t\t\tthis.player.pause(); \n\t\t}\n\n\t\tmute() {\n\t\t\tthis.player.muted = true;\n\t\t\tthis.isMuted = true;\n\t\t}\n\n\t\tunmute() {\n\t\t\tthis.player.muted = false; \n\t\t\tthis.isMuted = false;\n\t\t}\n\n\t\tstatic init(media: MediaStream) {\n\t\t\tAudioStream.source = AudioStream.context.createMediaStreamSource(media);\n\t\t\tAudioStream.source.connect(AudioStream.analyser);\n\t\t\tAudioStream.analyser.connect(AudioStream.context.destination);\n\n\t\t\tAudioStream.frequency = new Uint8Array(AudioStream.analyser.frequencyBinCount);\n\t\t\tAudioStream.analyser.getByteFrequencyData(AudioStream.frequency);\n\t\t\tAudioStream.analyser.fftSize = 2048;\n\t\t\tAudioStream.bufferLength = AudioStream.analyser.frequencyBinCount;\n\n\t\t}\n\n\t\tstatic connect(media: MediaStream) {\n\t\t\tAudioStream.init(media);\n\t\t\tAudioStream.canvas = document.getElementById('canvas_webview') as HTMLCanvasElement;\n\t\t\tAudioStream.ctx = AudioStream.canvas.getContext('2d');\n\t\t\t//AudioStream.ctx.fillStyle = \"black\";\n\t\t\tAudioStream.canvas.height = 100;\n\t\t\tAudioStream.canvas.width  = 300;\t\n\t\t\tAudioStream.barWidth = (AudioStream.WIDTH / AudioStream.bufferLength) * 0.5;\n\t\t\tAudioStream.renderFrame();\n\t\t}\n\n\t\tstatic renderFrame() {\n\t\t\trequestAnimationFrame(AudioStream.renderFrame);\n\n\t\t\tlet barheight =0, x = 0;\n\t\t\tAudioStream.analyser.getByteFrequencyData(AudioStream.frequency);\n\t\t\tAudioStream.ctx.fillStyle = \"black\";\n\t\t\tAudioStream.ctx.fillRect(0,0, AudioStream.WIDTH, AudioStream.HEIGHT);\n\n\t\t\tlet center = Math.round(AudioStream.WIDTH/2) - 1;\n\t\t\tfor(var i =0; i < AudioStream.bufferLength; i++) {\n\t\t\t\tbarheight = AudioStream.bufferLength[i] /2;\n\t\t\t\tAudioStream.ctx.fillStyle = 'red';\n\t\t\t\tAudioStream.ctx.fillRect(x, AudioStream.HEIGHT - barheight, AudioStream.barWidth, barheight);\n\t\t\t\tx = (center + (i % 2 == 0 ? -1 : 1) * Math.round(1 / 2));\n\t\t\t}\n\t\t}\n\n\t\tsocketConnect() {\n\t\t\tlet ssocket = new WebSocket('ws://' + process.env.VUE_APP_ENDPOINT);\n\t\t\t\n\t\t\tssocket.onopen = () => ssocket.send('audio-started');\n\t\t\tssocket.onmessage = (m) => {\n\t\t\t\tm = JSON.parse(m.data);\n\t\t\t\tif(m['audiostarted']) this._connectA(m['audiostarted']);\n\t\t\t}\n\n\t\t\tssocket.onclose = (c) => setTimeout(() => this.socketConnect(), 2000);\n\t\t\tssocket.onerror = (e) => ssocket.close();\n\t\t}\n\n\n\t\tformatTime(seconds, guide = seconds) {\n\t\t\t seconds = seconds < 0 ? 0 : seconds;\n\t\t\tlet s = Math.floor(seconds % 60);\n\t\t\tlet m = Math.floor(seconds / 60 % 60);\n\t\t\tlet h = Math.floor(seconds / 3600);\n\t\t\tconst gm = Math.floor(guide / 60 % 60);\n\t\t\tconst gh = Math.floor(guide / 3600);\n\t\t\t\n\t\t\t// handle invalid times\n\t\t\tif (isNaN(seconds) || seconds === Infinity) {\n\t\t\t\t// '-' is false for all relational operators (e.g. <, >=) so this setting\n\t\t\t\t// will add the minimum number of fields specified by the guide\n\t\t\t\th = m = s = 0 ; //'-';\n\t\t\t}\n\n\t\t\t// Check if we need to show hours\n\t\t\t//h = (h > 0 || gh > 0) ? h + ':' : '';\n\t\t\tvar hours = (h > 0 || gh > 0) ? h + ':' : '';\n\n\t\t\t// If hours are showing, we may need to add a leading zero.\n\t\t\t// Always show at least one digit of minutes.\n\t\t\t//m = (((h || gm >= 10) && m < 10) ? '0' + m : m) + ':';\n\t\t\tvar minute  = (((h || gm >= 10) && m < 10) ? '0' + m : m) + ':';\n\n\n\t\t\t// Check if leading zero is need for seconds\n\t\t\t//s = (s < 10) ? '0' + s : s;\n\t\t\tvar second = (s < 10) ? '0' + s : s;\n\n\t\t\treturn hours + minute + second;\n\t\t}*/\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--13-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./audioStream.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--13-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./audioStream.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./audioStream.vue?vue&type=template&id=4c6e991c&\"\nimport script from \"./audioStream.vue?vue&type=script&lang=ts&\"\nexport * from \"./audioStream.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}